<!-- LIGHTBOX SKELETON -->
<div id="root_lightbox" class="full_screen" ng-controller="GroupCreateCtrl">
    <div id="lightbox" class="wide_lightbox">
        <div id="lightbox_wrap">

            <div id="lightbox_header">

                <div id="lightbox_header_text">
                    <div class="title">Create a group</div>
                </div>

                <div id="lightbox_close" ng-click="closeThisDialog()">
                    <div class="table_cell">
                        <div class="sprite sprite-btn-popup-close2x">
                        </div>
                    </div>
                </div>

                <div class="clearer"></div>

                <div class="header_row_wrap">
                    <div class="header_row" slide-controller identifier="createGroupSlider" start_slide_at="306">
                        <div class="tab_button" ng-click="tabSelected = 'settings'" ng-class="tabSelected === 'settings' ? 'active' : ''">
                            <div class="tab_buttom_wrap">
                                <div class="tab_button_text">SETTINGS</div>
                                <div class="blue_bottom_line"></div>
                            </div>
                        </div>
                        <div class="tab_button" ng-click="tabSelected = 'memberTopicsCreate'" ng-class="tabSelected === 'memberTopicsCreate' ? 'active' : ''">
                            <div class="tab_buttom_wrap">
                                <div class="tab_button_text">ADD TOPICS</div>
                                <div class="blue_bottom_line"></div>
                            </div>
                        </div>
                        <div class="tab_button" ng-click="tabSelected = 'memberUsersCreate'" ng-class="tabSelected === 'memberUsersCreate' ? 'active' : ''">
                            <div class="tab_buttom_wrap">
                                <div class="tab_button_text">INVITE USERS</div>
                                <div class="blue_bottom_line"></div>
                            </div>
                        </div>

                        <div ng-if="wWidth > 560" class="blue_button_wrap">
                            <!--FIXME: Should be based on if any Users were added or not...-->
                            <div class="blue_button" ng-if="!app.createGroupsInviteUsers" ng-click="doSaveGroup()">
                                Save group
                            </div>
                            <div class="blue_button" ng-if="app.createGroupsInviteUsers">
                                Save group and send invite
                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <div class="line lightest_line"></div>
            <!-- SETTINGS -->
            <div id="lightbox_content" ng-if="tabSelected === 'settings'">


                <div class="lightbox_section">

                    <div class="input_description">
                        Insert a name for your group that is clear and understandable for people.
                    </div>
                    <input placeholder="Group name" ng-model="group.name" ng-class="{'error_input': errors.group.name}">
                    <label for="group.name" class="error_label" ng-if="errors.group.name">
                        <div class="table_cell">
                            <div class="sprite sprite-icon-inputfield-error2x"></div>
                            <span>No group name</span>
                        </div>
                    </label>
                </div>

                <div class="line lightest_line mobile_only"></div>

                <div class="lightbox_section">
                    <div class="content_inside_wrap">
                        Upload group avatar
                        <div class="gray_button">
                            Choose a file
                        </div>
                        <div class="clearer"></div>
                    </div>
                </div>

                <div class="line lightest_line mobile_only"></div>

                <div class="lightbox_section">

                    <div class="content_inside_footer">
                        Make your group private (only invited users can see it)
                        <div class="toggle_wrap">
                            <div class="toggle_widget text_on relative" ng-click="doSetGroupVisibility(group.visibility)" ng-class="{no: (group.visibility === Group.VISIBILITY.private), yes: (group.visibility === Group.VISIBILITY.public)}">
                                <div class="toggle_circle"></div>
                                <div class="toggle_text text_no">
                                    <div class="table_cell">NO</div>
                                </div>
                                <div class="toggle_text text_yes">
                                    <div class="table_cell">YES</div>
                                </div>
                            </div>
                        </div>

                        <div class="clearer"></div>
                    </div>
                </div>
            </div>

            <!-- ADD TOPICS -->
            <div id="lightbox_content" class="padding_bottom_zero" ng-if="tabSelected === 'memberTopicsCreate'">
                <div class="lightbox_section">
                    <div cos-dropdown ng-class="{search_with_dropdown : searchResults.topics.length, dropdown_active : searchResults.topics.length}">
                        <typeahead class="searchbox_with_icon_and_text auto-complete" items="searchResults.topics" term="searchStringTopic" search="search(term, 'topic')"
                                   select="addTopicToGroup(item)" ng-attr-placeholder="Search for a topic">
                           <div class="search_icon">
                                <div class="table_cell">
                                    <div class="sprite sprite-icon-search-gray-2x"></div>
                                </div>
                            </div>
                            <div class="search_text" ng-click="addTopicToGroup(item)">
                                <div class="table_cell blue_link">
                                    Press enter to add
                                </div>
                            </div>
                            <div class="search_area_wrap"  ng-show="searchResults.topics.length">
                                <div class="search_dropdown_area">
                                    <div class="search_dropdown_item" typeahead-item="topic" ng-repeat="topic in searchResults.topics">
                                        <div class="table_cell search_item_text">
                                            <b>{{topic.title}}</b>
                                        </div>
                                        <div class="table_cell blue_link">
                                            <span class="submit_link" ng-click="addTopicToGroup(topic)">Press enter or click to add</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </typeahead>
                    </div>
                </div>
                <div class="lightbox_section double_row_list small_header">
                    <div class="category_title" ng-show="memberTopics.length">
                        <div class="table_cell">
                            Order by:
                        <div class="black_link" ng-click="doOrderTopics('title')">
                            Title A-Z
                            <div class="sprite sprite-icon-list-ordering2x" ng-if="topicList.searchOrderBy.property === 'title' || topicList.searchOrderBy.property === '-title'" ng-class="{desc : topicList.searchOrderBy.property === '-title'}"></div>
                        </div>
                        <div class="black_link" ng-click="doOrderTopics('members.users.count')">
                            Users
                            <div class="sprite sprite-icon-list-ordering2x" ng-if="topicList.searchOrderBy.property === 'members.users.count' || topicList.searchOrderBy.property === '-members.users.count'" ng-class="{desc : topicList.searchOrderBy.property === '-members.users.count'}"></div>
                        </div>
                        </div>
                    </div>

                    <div class="double_row_item" ng-repeat="topic in memberTopics | orderBy: topicList.searchOrderBy.property">
                        <div class="blue_link">
                            {{topic.title}}
                        </div>
                        <div class="double_row_footer">
                            <div class="left">Topic users: <b>{{topic.members.users.count}}</b></div>
                            <div class="right">
                                <span class="dropdown_description">Group right over topic:</span>

                                <div class="btn_wrap recycle_bin white_bg">
                                    <div class="btn">
                                        <div class="table_cell" ng-click="removeTopicFromGroup(topic.id)">
                                            <div class="sprite desktop_fix sprite-mytopics-icon-deletetopic2x"></div>
                                            <div class="sprite mobile_fix sprite-voted-check2x"></div>
                                        </div>
                                    </div>
                                </div>

                                <div cos-dropdown class="classic_dropdown">
                                    <div class="dropdown_selection">
                                        <div class="dropdown_text">
                                            {{topic.permission.level}}
                                        </div>

                                        <div class="arrow_holder">
                                            <div class="table_cell">
                                                <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                                                <div class="v_line"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <div class="dropdown_item" ng-repeat="level in GroupMemberTopic.LEVELS">
                                            <div class="item_name" ng-click="doSetGroupTopicLevel(topic.id, level)">
                                                {{level}}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="clearer"></div>

                        </div>
                    </div>

                </div>
            </div>

            <!-- INVITE USERS -->
            <div id="lightbox_content" class="padding_bottom_zero" ng-if="tabSelected === 'memberUsersCreate'">

                <div class="lightbox_section">

                    <div class="input_text_margin_bottom">
                        Invite users via their name or e-mail address or invite an entire group
                    </div>

                    <div class="searchbox_with_icon_and_text only_text">
                        <div cos-dropdown ng-class="{search_with_dropdown : searchResults.users.length, dropdown_active : searchResults.users.length}">
                            <typeahead id="userSearch" class="auto-complete" items="searchResults.users" term="searchStringUser" search="search(term, 'user')"
                                       select="addUserAsMember(item)" ng-attr-placeholder="{{'PLACEHOLDER_USERNAME_OR_EMAIL' | translate}}">
                                <div class="search_area_wrap">
                                    <div class="search_dropdown_area" ng-show="searchResults.users.length">
                                        <div class="search_dropdown_item" typeahead-item="user" ng-repeat="user in searchResults.users">
                                            <div class="table_cell search_item_text">
                                                <b>{{user.name}}</b> {{user.company}}
                                            </div>
                                            <div class="table_cell blue_link">
                                                <span class="submit_link" ng-click="addUserAsMember(user)">Press enter or click to add</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </typeahead>

                        </div>
                        <div class="search_text">
                            <div class="table_cell blue_link" ng-click="doSubmitUser()">
                                Press enter to add
                            </div>
                        </div>
                    </div>

                </div>


                <div class="lightbox_section double_row_list user_list">

                    <div ng-repeat="(key, members) in group.members" ng-if="members.length">

                        <div class="category_title">
                            <div class="table_cell">
                                {{key | uppercase}}
                            </div>
                        </div>

                        <table>

                            <tr ng-repeat="(memberKey, member) in members">
                                <td>
                                    <div class="profile_image_wrapper dark">
                                        <div class="profile_moon sprite sprite-icon-certified-fb2x"></div>
                                        <div class="account_picture">
                                            <img ng-if="member.imageUrl" src="{{member.imageUrl}}">
                                            <div class="profile_image_filler">
                                                <div class="table_cell">
                                                    ML
                                                </div>
                                                <div class="profile_circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="name_wrap">
                                        <div class="table_cell">
                                            <div class="blue_link" ng-click="doRemoveMemberUser(member.id)">{{member.name}}</div>
                                            <div class="via">{{member.company}}</div>
                                        </div>
                                    </div>

                                    <div class="mobile_extra_info">
                                        <div class="left">
                                            <div cos-dropdown class="classic_dropdown">

                                                <div class="dropdown_selection">
                                                    <div class="dropdown_text">
                                                        {{member.level}}
                                                    </div>

                                                    <div class="arrow_holder">
                                                        <div class="table_cell">
                                                            <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                                                            <div class="v_line"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="dropdown">
                                                    <div class="dropdown_item" ng-repeat="level in GroupMemberUser.LEVELS">
                                                        <div class="item_name" ng-click="doChangeMemberPermissions(member.id, level)">
                                                            {{level}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="right">
                                            <div class="btn_wrap recycle_bin white_bg">
                                                <div class="btn">
                                                    <div class="table_cell">
                                                        <div class="sprite sprite-mytopics-icon-deletetopic2x" ></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <td>
                                    <div cos-dropdown class="classic_dropdown">

                                        <div class="dropdown_selection">
                                            <div class="dropdown_text">
                                                {{member.level}}
                                            </div>

                                            <div class="arrow_holder">
                                                <div class="table_cell">
                                                    <div class="sprite sprite-icon-dropdown-arrowdown2x"></div>

                                                    <div class="v_line"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="dropdown">
                                            <div class="dropdown_item" ng-repeat="level in GroupMemberUser.LEVELS">
                                                <div class="item_name" ng-click="doChangeMemberPermissions(member.id, level)">
                                                    {{level}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="btn_wrap recycle_bin white_bg">
                                        <div class="btn"  ng-click="doRemoveMemberUser(member.id)">
                                            <div class="table_cell">
                                                <div class="sprite desktop_fix sprite-mytopics-icon-deletetopic2x"></div>
                                                <div class="sprite mobile_fix sprite-mytopics-icon-deletetopic2x"></div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                        </table>

                    </div>


                </div>

            </div>


            <!-- MOBILE SAVE BUTTON -->
            <div ng-if="wWidth <= 560" class="blue_button_wrap mobile">
                <div class="blue_button" ng-if="!app.createGroupsInviteUsers">
                    Save group
                </div>
                <div class="blue_button" ng-if="app.createGroupsInviteUsers">
                    Save group and send invite
                </div>
            </div>


        </div>
    </div>

    <div id="close_lightbox" ng-click="closeThisDialog()">
    </div>

</div>
